!function(e){"use strict";e.module("alt.koopon.selecao-empresa",["ngResource","alt.passaporte-usuario-logado","alt.alerta-flutuante","alt.passaporte-procuracao","alt.alerta-flutuante","alt.carregando-info"]).config(["$httpProvider",function(e){e.interceptors.push("AltKooponEmpresaNaoSelecionadaInterceptor")}]).constant("ID_KOOPON_EMPRESA","60f1fe1f835b14a3d20ac0f046fac668").constant("ID_KOOPON_CONTADOR","3c59dc048e8850243be8079a5c74d079").constant("AltKooponEventoEmpresa",{EVENTO_EMPRESA_ESCOLHIDA:"alt.koopon.empresa-escolhida",EVENTO_EMPRESA_NAO_CONFIGURADA:"alt.koopon.empresa-nao-configurada"}).factory("AltKooponEmpresaNaoSelecionadaInterceptor",["$rootScope","$q","$location","AltKooponEventoEmpresa",function(e,o,a,r){return{responseError:function(t){var n=!!t&&403===t.status&&!!t.data&&t.data.deveSelecionarEmpresa,s=!!~a.path().indexOf("wizard");return n&&!s&&(e.$broadcast(r.EVENTO_EMPRESA_NAO_CONFIGURADA),a.path("/selecao-empresas")),o.reject(t)}}}]).provider("AltKoopon_BASE_API",function(){this.url="/koopon-rest-api/",this.$get=function(){return this.url}}).factory("AltKooponEmpresaResource",["$resource","AltKoopon_BASE_API",function(e,o){var a=o+"assinantes/selecao",r={},t={escolhe:{method:"POST",isArray:!1}};return e(a,r,t)}]).factory("AltKooponEmpresaService",["$rootScope","$q","$xtorage","AltPassaporteUsuarioLogadoManager","AltKooponEmpresaResource","AltKooponEventoEmpresa",function(e,o,a,r,t,n){var s="emp_escolhida",c=function(){};return c.prototype.getEmpresas=function(e){var o=e||"assinantes";return r.retorna()[o]},c.prototype.salvaNaStorageEmpresaEscolhida=function(e,o){var r=o||s;a.save(r,e)},c.prototype.getEmpresaEscolhidaDaStorage=function(e){var o=e||s;return a.get(o)},c.prototype.escolhe=function(a){return angular.isUndefined(a)||!angular.isObject(a)||angular.isUndefined(a.id)?o.reject(new TypeError("Empresa deve ser informada para ser passada ao servidor.")):t.escolhe({empresaEscolhida:a.id}).$promise.then(function(o){return e.$broadcast(n.EVENTO_EMPRESA_ESCOLHIDA,a),o})["catch"](function(e){return o.reject(e)})},new c}]).service("AltKooponSelecaoEmpresasHelper",["$location","AltKooponEmpresaService",function(e,o){this.escolheEmpresaSemProcuracao=function(a){return o.escolhe(a).then(function(){o.salvaNaStorageEmpresaEscolhida(a),e.path("/")})}}]).controller("AltKooponSelecaoEmpresasController",["AltKooponSelecaoEmpresasHelper","AltKooponEmpresaService","AltAlertaFlutuanteService","AltCarregandoInfoService",function(e,o,a,r){var t=this;t.empresas=[],t.escolheEmpresa=function(o){r.exibe(),e.escolheEmpresaSemProcuracao(o)["catch"](function(e){a.exibe({msg:e.mensagem})})["finally"](function(){r.esconde()})},t.init=function(e){t.empresas=o.getEmpresas(e)||t.empresas,1===t.empresas.length&&t.escolheEmpresa(t.empresas[0])}}]).controller("AltEmpresaEscolhidaController",["$rootScope","$scope","AltKooponEmpresaService",function(e,o,a){var r=this;r.empresaEscolhida=a.getEmpresaEscolhidaDaStorage(),o.$on("$destroy",function(){r.empresaEscolhida=null})}])}(window.angular);