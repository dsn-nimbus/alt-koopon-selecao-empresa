!function(e){"use strict";e.module("alt.koopon.selecao-empresa",["ngResource","alt.passaporte-usuario-logado","alt.alerta-flutuante","alt.carregando-info"]).config(["$httpProvider",function(e){e.interceptors.push("AltKooponEmpresaNaoSelecionadaInterceptor")}]).factory("AltKooponEmpresaNaoSelecionadaInterceptor",["$q","$location",function(e,o){return{responseError:function(r){var a=!!r&&403===r.status&&!!r.data&&r.data.deveSelecionarEmpresa;return a&&o.path("/selecao-empresas"),e.reject(r)}}}]).provider("AltKoopon_BASE_API",function(){this.url="/koopon-rest-api/",this.$get=function(){return this.url}}).factory("AltKooponEmpresaResource",["$resource","AltKoopon_BASE_API",function(e,o){var r=o+"assinantes/selecao",a={},t={escolhe:{method:"POST",isArray:!1}};return e(r,a,t)}]).factory("AltKooponEmpresaService",["$q","$xtorage","AltPassaporteUsuarioLogadoManager","AltKooponEmpresaResource",function(e,o,r,a){var t="emp_escolhida",n=function(){};return n.prototype.getEmpresas=function(e){var o=e||"assinantes";return r.retorna()[o]},n.prototype.salvaNaStorageEmpresaEscolhida=function(e,r){var a=r||t;o.save(a,e)},n.prototype.getEmpresaEscolhidaDaStorage=function(e){var r=e||t;return o.get(r)},n.prototype.escolhe=function(o){return angular.isUndefined(o)||!angular.isObject(o)||angular.isUndefined(o.id)?e.reject(new TypeError("Empresa deve ser informada para ser passada ao servidor.")):a.escolhe({empresaEscolhida:o.id}).$promise.then(function(e){return e})["catch"](function(o){return e.reject(o)})},new n}]).controller("AltKooponSelecaoEmpresasController",["$location","AltKooponEmpresaService","AltAlertaFlutuanteService","AltCarregandoInfoService",function(e,o,r,a){var t=this;t.empresas=[],t._escolheEmpresa=function(t){a.exibe(),o.escolhe(t).then(function(){e.path("/"),o.salvaNaStorageEmpresaEscolhida(t)})["catch"](function(e){r.exibe({msg:e.mensagem})})["finally"](function(){a.exibe()})},t.escolheEmpresa=function(e){t._escolheEmpresa(e)},t.init=function(e){t.empresas=o.getEmpresas(e)||t.empresas,1===t.empresas.length&&t._escolheEmpresa(t.empresas[0])}}])}(window.angular);